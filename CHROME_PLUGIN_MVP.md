# Chrome Plugin MVP Specification

## Goal
Enable users to capture any table from any website, convert to TQL, and share to trustquery.com community.

## User Flow

### Step 1: Detection
- User visits page with data table (Wikipedia, government site, news, etc.)
- Extension icon shows badge when tables detected on page
- Click extension â†’ shows list of detected tables on page

### Step 2: Preview & Convert
- User selects which table to convert
- Extension shows preview:
  - First 5 rows of data
  - Detected columns
  - Row count
- Click "Convert to TQL" button

### Step 3: Auto-Generation
```typescript
// Convert table to TQL using existing CLI
const csvData = tableToCSV(selectedTable)
const tqlDoc = generateTqlDocument({
  source: { format: 'csv', data: csvData },
  facet: { name: '@table' }
})

// Auto-generate metadata using AI
const metadata = await generateMetadata({
  tqlDoc,
  sourceUrl: window.location.href,
  pageTitle: document.title,
  tableContext: getTableContext(selectedTable)
})
```

### Step 4: Share
- Show sharing dialog:
  - Dataset title (editable, pre-filled from AI)
  - Category tags (editable, pre-filled from AI)
  - Description (editable, pre-filled from AI)
  - Source URL (auto-filled)
  - Make public/private toggle
- Click "Share to TrustQuery"
- Upload to trustquery.com
- Show success + link to dataset page

## Extension UI Components

### 1. Popup (when clicking extension icon)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TrustQuery                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š 3 tables detected on page    â”‚
â”‚                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Table 1: GDP by Country   â”‚  â”‚
â”‚ â”‚ 195 rows Ã— 4 columns      â”‚  â”‚
â”‚ â”‚ [Convert]                 â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Table 2: Population Data  â”‚  â”‚
â”‚ â”‚ 50 rows Ã— 6 columns       â”‚  â”‚
â”‚ â”‚ [Convert]                 â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Conversion Panel (after clicking Convert)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Converting to TQL...            â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 100%        â”‚
â”‚                                 â”‚
â”‚ âœ“ Extracted 195 rows            â”‚
â”‚ âœ“ Generated TQL document        â”‚
â”‚ âœ“ Auto-generated metadata       â”‚
â”‚                                 â”‚
â”‚ [Share to TrustQuery]           â”‚
â”‚ [Download TQL]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Share Dialog
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Share Dataset                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Title:                          â”‚
â”‚ [GDP by Country (2024)]         â”‚
â”‚                                 â”‚
â”‚ Category:                       â”‚
â”‚ [Ã—economics Ã—gdp Ã—government]   â”‚
â”‚                                 â”‚
â”‚ Description:                    â”‚
â”‚ [Gross Domestic Product data    â”‚
â”‚  for 195 countries, sourced     â”‚
â”‚  from World Bank Open Data]     â”‚
â”‚                                 â”‚
â”‚ Source:                         â”‚
â”‚ https://worldbank.org/...       â”‚
â”‚                                 â”‚
â”‚ â˜‘ Make public                   â”‚
â”‚                                 â”‚
â”‚ [Cancel]  [Share]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Auto-Generated Metadata

### What AI Should Generate

```typescript
interface AutoGeneratedMetadata {
  // Dataset identification
  title: string              // "GDP by Country (2024)"
  description: string        // 2-3 sentence description

  // Categorization
  categories: string[]       // ["economics", "gdp", "government"]
  domain: string            // "economics" | "sports" | "science" | etc.

  // Source context
  sourceUrl: string         // Where it came from
  sourceName: string        // "World Bank Open Data"
  sourceType: string        // "government" | "news" | "wikipedia" | etc.
  capturedAt: string        // ISO timestamp

  // Data characteristics
  timeframe?: string        // "2024", "2020-2024", "Historical"
  geography?: string        // "Global", "United States", "Europe"
  updateFrequency?: string  // "Annual", "Monthly", "One-time"

  // Quality indicators
  completeness: number      // 0-1 score
  structureQuality: number  // 0-1 score (how well-formed is the table)

  // Suggested column meanings (populate @meaning facet)
  columnMeanings: Record<string, string>
}
```

### AI Prompt for Metadata Generation

```typescript
const prompt = `
You are analyzing a data table extracted from a website. Generate metadata to help others discover and understand this dataset.

SOURCE CONTEXT:
- Page URL: ${sourceUrl}
- Page Title: ${pageTitle}
- Table Context: ${tableContext}

TABLE STRUCTURE:
${JSON.stringify({
  headers: csvData.headers,
  sampleRows: csvData.rows.slice(0, 5),
  totalRows: csvData.rows.length
}, null, 2)}

Generate JSON metadata:
{
  "title": "Concise, descriptive title (max 100 chars)",
  "description": "2-3 sentence description of what this data represents",
  "categories": ["3-5 relevant tags"],
  "domain": "primary domain (economics|sports|science|government|health|etc)",
  "sourceName": "Extracted source name",
  "sourceType": "government|news|wikipedia|academic|commercial|other",
  "timeframe": "Time period covered (if applicable)",
  "geography": "Geographic scope (if applicable)",
  "updateFrequency": "How often this data updates (if known)",
  "completeness": 0.0-1.0,
  "structureQuality": 0.0-1.0,
  "columnMeanings": {
    "column_name": "What this column represents"
  }
}
`
```

## Backend API

### POST /api/datasets/share

**Request:**
```typescript
{
  // TQL data
  tqlDocument: TqlDocument,
  tqlMarkdown: string,

  // Metadata (from AI + user edits)
  metadata: {
    title: string,
    description: string,
    categories: string[],
    domain: string,
    sourceUrl: string,
    sourceName: string,
    sourceType: string,
    timeframe?: string,
    geography?: string,
    isPublic: boolean,

    // Auto-generated quality scores
    completeness: number,
    structureQuality: number
  },

  // User info (from auth)
  userId: string
}
```

**Response:**
```typescript
{
  success: true,
  datasetId: string,
  url: string  // e.g., "https://trustquery.com/datasets/abc123"
}
```

## TrustQuery.com Dataset Page

### Simple Gallery View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TrustQuery Datasets                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ ğŸ” [Search datasets...]                 â”‚
â”‚                                         â”‚
â”‚ Filter by:                              â”‚
â”‚ â–¡ Economics  â–¡ Sports  â–¡ Science        â”‚
â”‚ â–¡ Government â–¡ Health  â–¡ Other          â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“Š GDP by Country (2024)            â”‚ â”‚
â”‚ â”‚ Economics â€¢ Government              â”‚ â”‚
â”‚ â”‚ 195 rows â€¢ Captured 2 hours ago     â”‚ â”‚
â”‚ â”‚ Source: World Bank Open Data        â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚ [View Dataset] [Download TQL]       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ€ NBA Player Stats 2023-24         â”‚ â”‚
â”‚ â”‚ Sports â€¢ Basketball                 â”‚ â”‚
â”‚ â”‚ 530 rows â€¢ Captured 5 hours ago     â”‚ â”‚
â”‚ â”‚ Source: Basketball Reference        â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚ [View Dataset] [Download TQL]       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Individual Dataset View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GDP by Country (2024)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ Gross Domestic Product data for 195     â”‚
â”‚ countries, sourced from World Bank.     â”‚
â”‚                                         â”‚
â”‚ ğŸ“ Source: worldbank.org/data/gdp       â”‚
â”‚ ğŸ‘¤ Shared by: @username                 â”‚
â”‚ ğŸ“… Captured: Nov 16, 2024               â”‚
â”‚ ğŸ·ï¸  Tags: economics, gdp, government    â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ @table Preview (195 rows)           â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚ country    | gdp_usd  | year | ... â”‚ â”‚
â”‚ â”‚------------|----------|------|-----â”‚ â”‚
â”‚ â”‚ USA        | 25.5T    | 2024 | ... â”‚ â”‚
â”‚ â”‚ China      | 17.9T    | 2024 | ... â”‚ â”‚
â”‚ â”‚ ...        | ...      | ...  | ... â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ [Download TQL] [Download JSON] [API]    â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ @meaning                            â”‚ â”‚
â”‚ â”‚ country: ISO country name           â”‚ â”‚
â”‚ â”‚ gdp_usd: GDP in US dollars         â”‚ â”‚
â”‚ â”‚ year: Reporting year                â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Table Detection Logic

### Priority Order

1. **Semantic HTML tables**: `<table>` elements
2. **ARIA tables**: `role="table"`
3. **Grid layouts**: Structured `<div>` grids that look like tables
4. **CSV/TSV**: Pre-formatted text blocks

### Quality Scoring

```typescript
function scoreTable(table: HTMLElement): number {
  let score = 0

  // Has proper structure
  if (table.querySelector('thead')) score += 2
  if (table.querySelector('tbody')) score += 2

  // Reasonable size
  const rows = table.querySelectorAll('tr').length
  if (rows >= 3 && rows <= 10000) score += 3

  // Has headers
  const headers = table.querySelectorAll('th').length
  if (headers > 0) score += 2

  // Mostly data (not navigation)
  const links = table.querySelectorAll('a').length
  if (links / rows < 0.5) score += 1

  return score / 10  // Normalize to 0-1
}

// Only show tables with score > 0.5
```

## Tech Stack

### Chrome Extension
- **Manifest V3**
- **Content Script**: Table detection & extraction
- **Background Service Worker**: API calls
- **Popup**: Extension UI
- **Storage**: Cache converted TQL temporarily

### Dependencies
```json
{
  "dependencies": {
    "@trustquery/cli": "^0.2.0",  // Your existing TQL library
    "papaparse": "^5.4.1",        // CSV parsing
    "cheerio": "^1.0.0"           // HTML parsing (if needed)
  }
}
```

### Backend (trustquery.com)
```typescript
// Simple Node/Express API
POST /api/datasets/share
GET  /api/datasets
GET  /api/datasets/:id
GET  /api/datasets/:id/download  // Returns .tql or .json
```

### AI Integration
```typescript
// Use OpenAI/Anthropic for metadata generation
import Anthropic from '@anthropic-ai/sdk'

async function generateMetadata(input: {
  tqlDoc: TqlDocument,
  sourceUrl: string,
  pageTitle: string,
  tableContext: string
}) {
  const client = new Anthropic()

  const response = await client.messages.create({
    model: 'claude-3-haiku-20240307',  // Fast + cheap for this
    messages: [{
      role: 'user',
      content: buildMetadataPrompt(input)
    }]
  })

  return JSON.parse(response.content[0].text)
}
```

## What NOT to Build (MVP)

âŒ No querying yet (just capture & share)
âŒ No user authentication (maybe just optional name)
âŒ No "most queried" analytics
âŒ No collaborative editing
âŒ No API access
âŒ No dataset versioning (yet)
âŒ No complex permissions

## Success Metrics (First Month)

- 100 datasets shared
- 10 different domains represented
- AI categorization accuracy > 80% (manual review)
- 50% of users edit AI-generated metadata (shows it's helpful but not perfect)

## Development Phases

### Phase 1 (Week 1-2): Extension Core
- Table detection
- CSV extraction
- TQL conversion
- Basic popup UI
- Download TQL file

### Phase 2 (Week 3): AI + Sharing
- Metadata generation prompt
- Share to backend API
- Simple dataset gallery page

### Phase 3 (Week 4): Polish
- Better table detection
- Handle edge cases
- Chrome Web Store submission
- Landing page for trustquery.com

## Open Questions

1. **Authentication**:
   - Option A: No auth, anyone can share (risk: spam)
   - Option B: GitHub OAuth (friction but quality)
   - Option C: Anonymous + optional claim later

2. **Storage**:
   - Where to store TQL files? (S3? Database?)
   - How big can datasets be? (limit to 10k rows?)

3. **Moderation**:
   - Manual review before public?
   - Automated spam detection?
   - User reporting?

## Next Steps

1. Set up Chrome extension boilerplate
2. Implement basic table detection
3. Integrate @trustquery/cli for conversion
4. Test on common sites (Wikipedia, government data, sports stats)
5. Build AI metadata generation
6. Create simple backend API
7. Build dataset gallery page
8. Test with 5-10 beta users
9. Submit to Chrome Web Store
